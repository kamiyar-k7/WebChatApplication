@page "/chatpage/2"
@layout ChatLayout
@inject NavigationManager _navmanager;
@inject UserProvider _userprovider;
@inject IPrivateChatService _chatservice

<!--top app bar-->
<MudAppBar Style="height:70px;" Class="d-flex justify-content-center">

    <MudGrid Class="d-flex align-items-center">

        <MudItem>
            <MudIconButton Icon="@Icons.Material.Filled.KeyboardArrowLeft" Edge="Edge.Start" OnClick="BackToHome" Style="color:white;" />

        </MudItem>

        <MudItem Class="">
            <MudImage Src="/Images/webicon.jpg"
                      Alt="User Profile"
                      ObjectFit="ObjectFit.Cover"
                      Fluid="true"
                      Width="50"
                      Height="50"
                      ObjectPosition="ObjectPosition.Center"
                      Class="rounded-circle" />

        </MudItem>

        <MudItem>
            <MudText Class="h6 fw-bold">User Name</MudText>
            <MudText Class="fw-light">Online</MudText>
        </MudItem>

        <MudSpacer />
        <MudItem Class="d-flex justify-content-end">
            <MudIconButton Icon="@Icons.Material.Filled.Savings" Size="Size.Large" Edge="Edge.End" Style="color:white;" />
        </MudItem>

    </MudGrid>

</MudAppBar>



<!--Bottom app bar-->
<MudAppBar Bottom="true" Fixed="true" Elevation="1" Style="height:100px;" Class="d-flex justify-content-center bg-dark">


    <EditForm Model="model" OnValidSubmit="SendMessage" Class=" d-flex align-items-center col-12" Style="height:auto;">

        <MudGrid Class=" d-flex align-items-center" Style="height:auto;">

            <MudItem xs="10" Class="d-flex">

                <MudTextField @bind-Value="@model.Content"
                              Placeholder="Type your message..."
                              Variant="Variant.Outlined"
                              Adornment="Adornment.None"
                              Class="w-100 white-text"
                              AutoGrow
                              MaxLines="3"
                              Style="height: auto;" />

            </MudItem>

            <MudItem xs="2" Class="d-flex justify-content-end">
                <MudButton ButtonType="ButtonType.Submit"
                           Variant="Variant.Filled"
                           Color="Color.Primary"
                           EndIcon="@Icons.Material.Filled.Send"
                           IconColor="Color.Info"
                           Class="w-100 white-text"
                           Style="height: 40px; ">
                </MudButton>
            </MudItem>

        </MudGrid>

    </EditForm>

</MudAppBar>




@code {

    UserContext currentUser { get; set; }

    protected override async Task OnInitializedAsync()
    {
        currentUser = await _userprovider.SetCurrentUserFromClaims();
        Console.WriteLine($"current username {currentUser.UserName} Id : {currentUser.UserId}");
        await base.OnInitializedAsync();
    }

    private void BackToHome()
    {
        _navmanager.NavigateTo("/");
    }


    private int ResiverId;
    private MessageDto model = new MessageDto();


    private async Task SendMessage()
    {
        try
        {
            model.SenderId = currentUser.UserId;
            model.ResiverId = 2;
            await _chatservice.SendMessage(model);
        }

        catch (ApiException ex)
        {

            Console.WriteLine(ex.Message);
        }
    }
}




